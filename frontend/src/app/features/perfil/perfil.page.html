<ion-header class="perfil-header">
    <ion-toolbar>
        <ion-title>Perfil</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content class="perfil-content">
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-background"></div>
        <div class="profile-info">
            <div class="profile-avatar">
                <ion-icon name="person-outline"></ion-icon>
            </div>
            <h2>{{ authService.currentUser()?.nome || 'Usuário' }}</h2>
            <p class="profile-email">{{ authService.currentUser()?.email }}</p>

            <!-- Role atual com seletor -->
            <div class="profile-role" (click)="possuiMultiplasRoles() ? abrirSeletorRole() : null">
                <ion-badge [color]="isAdmin() ? 'secondary' : isBarbeiro() ? 'tertiary' : 'primary'">
                    {{ roleLabel() }}
                </ion-badge>
                @if (possuiMultiplasRoles()) {
                <ion-icon name="chevron-down-outline" class="role-switcher-icon"></ion-icon>
                }
            </div>

            @if (trocandoRole()) {
            <div class="role-loading">
                <ion-spinner name="dots" color="secondary"></ion-spinner>
            </div>
            }
        </div>
    </div>

    <!-- Menu Principal (por Role) -->
    <div class="menu-section">
        <h3 class="section-title">
            @if (isAdmin()) {
            Gestão da Barbearia
            } @else if (isBarbeiro()) {
            Área Profissional
            } @else {
            Minha Conta
            }
        </h3>

        <ion-list class="menu-list">
            @for (item of menuPrincipal(); track item.id) {
            <ion-item button detail (click)="navegarPara(item)">
                <ion-icon [name]="item.icone" slot="start" [color]="item.cor || 'primary'"></ion-icon>
                <ion-label>{{ item.label }}</ion-label>
                @if (item.badge && item.badge > 0) {
                <ion-badge slot="end" color="danger">{{ item.badge }}</ion-badge>
                }
            </ion-item>
            }
        </ion-list>
    </div>

    <!-- Trocar Perfil (múltiplas roles) -->
    @if (possuiMultiplasRoles()) {
    <div class="menu-section">
        <ion-list class="menu-list">
            <ion-item button (click)="abrirSeletorRole()">
                <ion-icon name="swap-horizontal-outline" slot="start" color="tertiary"></ion-icon>
                <ion-label>Trocar Perfil</ion-label>
                <ion-note slot="end">{{ roleLabel() }}</ion-note>
            </ion-item>
        </ion-list>
    </div>
    }

    <!-- Notificações -->
    <div class="menu-section">
        <ion-list class="menu-list">
            <ion-item>
                <ion-icon name="notifications-outline" slot="start" color="primary"></ion-icon>
                <ion-label>Notificações</ion-label>
                <ion-toggle [(ngModel)]="notificacoesAtivas" slot="end"></ion-toggle>
            </ion-item>
        </ion-list>
    </div>

    <!-- Menu Configurações -->
    <div class="menu-section">
        <h3 class="section-title">Suporte</h3>

        <ion-list class="menu-list">
            @for (item of menuConfig; track item.id) {
            <ion-item button detail (click)="navegarPara(item)">
                <ion-icon [name]="item.icone" slot="start" color="medium"></ion-icon>
                <ion-label>{{ item.label }}</ion-label>
            </ion-item>
            }
        </ion-list>
    </div>

    <!-- Botão Sair -->
    <div class="logout-section">
        <ion-button expand="block" fill="outline" color="danger" (click)="logout()">
            <ion-icon name="log-out-outline" slot="start"></ion-icon>
            Sair da Conta
        </ion-button>
    </div>

    <!-- Versão -->
    <div class="app-version">
        <p>Régua Máxima v1.0.0</p>
    </div>

    <!-- Action Sheet para trocar role -->
    <ion-action-sheet [isOpen]="mostrarActionSheet()" header="Trocar para..." [buttons]="actionSheetButtons()"
        (didDismiss)="mostrarActionSheet.set(false)"></ion-action-sheet>
</ion-content>